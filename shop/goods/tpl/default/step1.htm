<div class="release-form">
    <form class="form-horizontal" role="form" action="{$strUrl}&step={$step}" method="post"  id="pubGoodsForm{$step}" name="pubGoodsForm{$step}">
  		<input type="hidden" name="{$step}" value="{$step}">
  		<input type="hidden" name="formhash" id="formhash" value="{FORMHASH}">
        <div class="form-group">
            <label for="txt_title" class="col-sm-2 control-label">作品名称：</label>
            <div class="col-sm-9">
            	<input type="text" class="form-control" id="txt_title" name="txt_title" placeholder="作品名称" value="{$arrPubInfo['txt_title']}">
            </div>
        </div>
        <!-- 标题名称 end -->
		
		<div class="form-group">
			<label for="tar_content" class="col-sm-2 control-label">作品描述：</label>
			<div class="col-sm-9">
				<textarea id="tar_content" name="tar_content"   placeholder="需求描述">{$arrPubInfo['tar_content']}</textarea>
				<script type="text/javascript" src="{$_K['siteurl']}/static/js/ueditor/ueditor.config.js"></script>
				<!--<script type="text/javascript" src="{$_K['siteurl']}/static/js/ueditor/ueditor.config.admin.js"></script>-->
				<!-- 编辑器源码文件 -->
				<script type="text/javascript" src="{$_K['siteurl']}/static/js/ueditor/ueditor.all.min.js"></script>
				<script type="text/javascript" src="{$_K['siteurl']}/static/js/ueditor/lang/zh-cn/zh-cn.js"></script>
				<!-- 实例化编辑器 -->
				<script type="text/javascript">
				var ue = UE.getEditor('tar_content', {
				//这里可以选择自己需要的工具按钮名称,此处仅选择如下五个
				initialFrameWidth: '100%',
				initialFrameHeight: '200'
				});
				</script>
			</div>

		</div>
          <!-- 需求描述 end -->

          <!--<div class="form-group">
            <label for="upload" class="col-sm-2 control-label">全景缩略图：</label>
            <div class="col-sm-8">
 				  <div id="picker">上传缩略图</div>
	              <input type="hidden"  name="fileid1" id="fileid1"  class="form-control" value="{if !empty($arrImageLists)}{$arrPubInfo['fileids']}{/if}">                         
            </div>     
             
          </div>-->
          <!-- 上传附件 end -->

          <div class="form-group ">
            <div class="col-sm-offset-2 col-sm-7">              
              <ul class="affix-list upload-file-list-info" id="edit_fileList_upload">
              {if !empty($arrImageLists)}
	              {loop $arrImageLists $v}
					<li id="edit-{$v['file_id']}" class="affix-list-item">
						<div class="upload-file-info">
							<span class="webuploader-pick-file-close" data-fileid="{$v['file_id']}" data-fileurl="{$v['save_name']}" data-queued-id="edit-{$v['file_id']}"><i class="close"></i></span>
							<span class="fname">{$v['file_name']}</span>
							<span class="fsize">大小:<!--{eval echo kekezu::fsize($v['save_name']);}--></span>
							<div class="clearfix"></div>
						</div>
					</li>
	              {/loop}
              {/if}
              </ul>
			  <ul class="affix-list upload-file-list-info" id="fileList_upload"></ul>
            </div>
          </div>
          <!-- 附件列表 end -->
		 <div class="form-group">
            <label for="txt_title" class="col-sm-2 control-label">标签：</label>
            <div class="col-sm-9">
              <input type="text" class="form-control" id="goods_tag" name="goods_tag" placeholder="标签" value="多个标签用逗号隔开！">
            </div>
          </div>
       <div class="form-group" id="submit_method">
			<input class="border_n" type="hidden" id="pay_down" name="submit_method" value="inside" />
            <label for="upload" class="col-sm-2 control-label">作品原稿：</label>
            <div class="col-sm-8">
 				  <div id="picker1">添加素材（全景图片/视频，可多选或者多次点击累计添加）</div>
	              <input type="hidden"  name="file_path_2" id="file_path_2"  class="form-control" value="{if !empty($arrFileLists)}{$arrPubInfo['file_path_2']}{/if}">
            </div>
          </div>
          <!-- 上传附件 end -->
		  
		 
		  

          <div class="form-group ">
            <div class="col-sm-offset-2 col-sm-7">
              
              <ul class="affix-list upload-file-list-info" id="edit_fileList_file_path_2">
              {if !empty($arrFileLists)}
	              {loop $arrFileLists $v}
					<li id="edit-{$v['file_id']}" class="affix-list-item">
						<div class="upload-file-info">
							<span class="webuploader-pick-file-close" data-fileid="{$v['file_id']}" data-fileurl="{$v['save_name']}" data-queued-id="edit-{$v['file_id']}"><i class="close"></i></span>
							<span class="fname">{$v['file_name']}</span>
							<span class="fsize">大小:<!--{eval echo kekezu::fsize($v['save_name']);}--></span>
							<div class="clearfix"></div>
						</div>
					</li>
	              {/loop}
              {/if}
              </ul>
			  <ul class="affix-list upload-file-list-info" id="fileList_file_path_2"></ul>
            </div>
          </div>
          <!-- 附件列表 end -->

		<div class="form-group">
			<div class="col-sm-1"></div>
			<div class="col-sm-10">
			<!--{template task/custom}-->
			</div>
		</div>
          
        <div class="form-group">           
            <label class="col-xs-12 col-sm-2 control-label ">作品分类：</label>
				<div class="col-xs-6 col-sm-3 col-md-3 col-lg-2 ">
				  <select class="form-control" name="indus_pid" id="indus_pid" onchange="getIndustry(this.value,'indus_id')">
					 {loop $arrTopIndustrys $v}
						<option value="{$v['indus_id']}" {if $arrPubInfo['indus_pid'] ==$v['indus_id']} selected="selected"{/if}>{$v['indus_name']}</option>
					 {/loop}
				   </select>
				</div>
          </div>
		{if $regionCfg['region_search_shop'] =='1'}
			<div class="form-group">
				<label class="col-xs-12 col-sm-2 control-label">
					拍摄地址：
					
				</label>
				<div class="col-xs-6 col-sm-5 col-md-3 col-lg-2" style="display: none;">
					<select class="form-control province" name="province" id="province" onchange="select_province(this, false)">
						<option value="">选择省份</option> 
					</select>
					<select class="form-control city" name="city" id="city">
						<option value="">选择城市</option> 
					</select>
				</div>
				<div class="col-xs-6 col-sm-3 col-md-4 col-lg-2">
					<input id="area" type="text" name="area" class="form-control" value="" />
					&nbsp;&nbsp;
				</div>
				<div class="col-xs-6 col-sm-3 col-md-4 col-lg-2 look_map"><button id="lookMapButton" type="button"  class="btn btn-primary">查看地图</button></div>
				
				<!--
				<div class="col-xs-6 col-sm-3 col-md-4 col-lg-2">
					<select class="form-control" name="area" id="area" onchange="getZone(this.value,'street');setTimeout(function(){$('#street').change();}, 800);">
						<option value="a">选择区域</option> 
						{loop $arrAreas $k $v}
						<option value="{$v['id']}">{$v['name']}</option>
						{/loop}
					</select>
				</div>
				<div class="col-xs-6 col-sm-3 col-md-4 col-lg-2">
					<select class="form-control" name="street" id="street" onchange="searchKeyword($(this).find('option:selected').text());">
						<option value="a">选择街道</option> 
						{loop $arrStreets $k $v}
						<option value="{$v['id']}">{$v['name']}</option>
						{/loop}
					</select>
				</div> 
				-->
			</div>

			<style>
			.form-control.province{
				margin-right: 4%;
				float: left;
				width: 48%;
			}
			.form-control.city{
				float: left;
				width: 48%;
			}
			.map_panel{
				margin: 0px 20px 30px 0px;
				float: left;
				width: 30%;
			}
			
			.map_address{
				padding: 0px 30px;
				font-size: 14px;
			}
			
			.map_address a{
			}
			
			.form-group .look_map{
				padding: 0px;
			}
			</style>
			<script language=javascript> 
			cities = new Object(); 
			cities['北京']=new Array('北京'); 
			cities['上海']=new Array('上海'); 
			cities['天津']=new Array('天津'); 
			cities['重庆']=new Array('重庆'); 
			cities['河北省']=new Array('石家庄', '张家口', '承德', '秦皇岛', '唐山', '廊坊', '保定', '沧州', '衡水', '邢台', '邯郸'); 
			cities['山西省']=new Array('太原', '大同', '朔州', '阳泉', '长治', '晋城', '忻州', '吕梁', '晋中', '临汾', '运城'); 
			cities['辽宁省']=new Array('沈阳', '朝阳', '阜新', '铁岭', '抚顺', '本溪', '辽阳', '鞍山', '丹东', '大连', '营口', '盘锦', '锦州', '葫芦岛'); 
			cities['吉林省']=new Array('长春', '白城', '松原', '吉林', '四平', '辽源', '通化', '白山', '延边'); 
			cities['黑龙江省']=new Array('哈尔滨', '齐齐哈尔', '黑河', '大庆', '伊春', '鹤岗', '佳木斯', '双鸭山', '七台河', '鸡西', '牡丹江', '绥化', '大兴安'); 
			cities['江苏省']=new Array('南京', '徐州', '连云港', '宿迁', '淮阴', '盐城', '扬州', '泰州', '南通', '镇江', '常州', '无锡', '苏州'); 
			cities['浙江省']=new Array('杭州', '湖州', '嘉兴', '舟山', '宁波', '绍兴', '金华', '台州', '温州', '丽水'); 
			cities['安徽省']=new Array('合肥', '宿州', '淮北', '阜阳', '蚌埠', '淮南', '滁州', '马鞍山', '芜湖', '铜陵', '安庆', '黄山', '六安', '巢湖', '池州', '宣城'); 
			cities['福建省']=new Array('福州', '南平', '三明', '莆田', '泉州', '厦门', '漳州', '龙岩', '宁德'); 
			cities['江西省']=new Array('南昌', '九江', '景德镇', '鹰潭', '新余', '萍乡', '赣州', '上饶', '抚州', '宜春', '吉安'); 
			cities['山东省']=new Array('济南', '聊城', '德州', '东营', '淄博', '潍坊', '烟台', '威海', '青岛', '日照', '临沂', '枣庄', '济宁', '泰安', '莱芜', '滨州', '菏泽'); 
			cities['河南省']=new Array('郑州', '三门峡', '洛阳', '焦作', '新乡', '鹤壁', '安阳', '濮阳', '开封', '商丘', '许昌', '漯河', '平顶山', '南阳', '信阳', '周口', '驻马店'); 
			cities['湖北省']=new Array('武汉', '十堰', '襄攀', '荆门', '孝感', '黄冈', '鄂州', '黄石', '咸宁', '荆州', '宜昌', '恩施', '襄樊'); 
			cities['湖南省']=new Array('长沙', '张家界', '常德', '益阳', '岳阳', '株洲', '湘潭', '衡阳', '郴州', '永州', '邵阳', '怀化', '娄底', '湘西'); 
			cities['广东省']=new Array('广州', '清远', '韶关', '河源', '梅州', '潮州', '汕头', '揭阳', '汕尾', '惠州', '东莞', '深圳', '珠海', '江门', '佛山', '肇庆', '云浮', '阳江', '茂名', '湛江'); 
			cities['海南省']=new Array('海口', '三亚'); 
			cities['四川省']=new Array('成都', '广元', '绵阳', '德阳', '南充', '广安', '遂宁', '内江', '乐山', '自贡', '泸州', '宜宾', '攀枝花', '巴中', '达川', '资阳', '眉山', '雅安', '阿坝', '甘孜', '凉山'); 
			cities['贵州省']=new Array('贵阳', '六盘水', '遵义', '毕节', '铜仁', '安顺', '黔东南', '黔南', '黔西南'); 
			cities['云南省']=new Array('昆明', '曲靖', '玉溪', '丽江', '昭通', '思茅', '临沧', '保山', '德宏', '怒江', '迪庆', '大理', '楚雄', '红河', '文山', '西双版纳'); 
			cities['陕西省']=new Array('西安', '延安', '铜川', '渭南', '咸阳', '宝鸡', '汉中', '榆林', '商洛', '安康'); 
			cities['甘肃省']=new Array('兰州', '嘉峪关', '金昌', '白银', '天水', '酒泉', '张掖', '武威', '庆阳', '平凉', '定西', '陇南', '临夏', '甘南'); 
			cities['青海省']=new Array('西宁', '海东', '西宁', '海北', '海南', '黄南', '果洛', '玉树', '海西'); 
			cities['内蒙古']=new Array('呼和浩特', '包头', '乌海', '赤峰', '呼伦贝尔盟', '兴安盟', '哲里木盟', '锡林郭勒盟', '乌兰察布盟', '鄂尔多斯', '巴彦淖尔盟', '阿拉善盟'); 
			cities['广西']=new Array('南宁', '桂林', '柳州', '梧州', '贵港', '玉林', '钦州', '北海', '防城港', '南宁', '百色', '河池', '柳州', '贺州'); 
			cities['西藏']=new Array('拉萨', '那曲', '昌都', '林芝', '山南', '日喀则', '阿里'); 
			cities['宁夏']=new Array('银川', '石嘴山', '吴忠', '固原'); 
			cities['新疆']=new Array('乌鲁木齐', '克拉玛依', '喀什', '阿克苏', '和田', '吐鲁番', '哈密', '博尔塔拉', '昌吉', '巴音郭楞', '伊犁', '塔城', '阿勒泰'); 
			cities['香港']=new Array('香港'); 
			cities['澳门']=new Array('澳门'); 
			cities['台湾']=new Array('台北','台南','其他'); 
			cities['其它']=new Array('其它'); 
			</script> 
			<script charset="utf-8" src="http://map.qq.com/api/js?v=2.exp&key=NTMBZ-TFX3P-RNXDW-VKOTM-ATXUZ-D7FDX"></script>
			<script>
			
			$(function(){
				for(var i in cities){
					$('<option>').html(i).attr('value', i).appendTo('#province'); 
				}
				map_init();
			});
			
			//直接加载地图
			//初始化地图函数  自定义函数名init
			function map_init() {
				//定义map变量 调用 qq.maps.Map() 构造函数   获取地图显示容器
				var map = new qq.maps.Map(document.getElementById("mapPanel"), {
					center: new qq.maps.LatLng(39.916527,116.397128),      // 地图的中心地理坐标。
					zoom:8                                                 // 地图的中心地理坐标。
				});
				var centerMarker = new qq.maps.Marker({ map: map });
				var centerGeocoder = new qq.maps.Geocoder();
				
				centerGeocoder.setComplete(function(result){
					var addressComponents = result.detail.addressComponents;
					select_address(addressComponents.country + addressComponents.province + addressComponents.city + addressComponents.district + addressComponents.street);
				});
				
				map_init.city = ''; //地图显示的城市
				map_init.address = ''; //地图显示的地址

				//控制城市的自动定位
				citylocation = new qq.maps.CityService({
					//请求成功回调函数
					complete: function(results) {
						map_init.city = results.detail.name;
						map.setCenter(result.detail.latLng);
					},
					error: function() {
						alert("出错了，请输入正确的经纬度！！！");
					}
				});
				citylocation.searchLocalCity();
				//添加地图点击事件

				var listener = qq.maps.event.addListener(
					map,
					'rightclick',
					function(results) {
						map.setCenter(results.latLng);
						centerMarker.setPosition(map.getCenter());
						centerGeocoder.getAddress(map.getCenter());
					}
				);
				
				var dragListener = qq.maps.event.addListener(
					map,
					'drag',
					function(results) {
						centerMarker.setPosition(map.getCenter());
					}
				);
				var dragListener = qq.maps.event.addListener(
					map,
					'dragstart',
					function(results) {
						centerMarker.setPosition(map.getCenter());
					}
				);
				var dragListener = qq.maps.event.addListener(
					map,
					'dragend',
					function(results) {
						centerMarker.setPosition(map.getCenter());
						centerGeocoder.getAddress(map.getCenter());
					}
				);
				
				
				setCity.cs = new qq.maps.CityService({
					complete : function(results){
						map.setZoom(8);
						map.setCenter(results.detail.latLng);
						map_init.city = results.detail.name;
						centerMarker.setPosition(map.getCenter());
						centerGeocoder.getAddress(map.getCenter());
						
					}
				});
				
				searchKeyword.ss = new qq.maps.SearchService({
					//检索成功的回调函数
					complete: function(results) {
						//设置回调函数参数
						var pois = results.detail.pois;
						var infoWin = new qq.maps.InfoWindow({
							map: map
						});
						var latlngBounds = new qq.maps.LatLngBounds();
						//调整地图视野
						map.setCenter(pois[0].latLng);
						map.setZoom(16);
						centerMarker.setPosition(map.getCenter());
						select_address(pois);
					},
					//若服务请求失败，则运行以下函数
					error: function() {
						alert("地图查询异常！");
					}
				});
				
				$('#lookMapButton').click(function(){
					if($('#lookMapButton').attr('disabled')){
						return false;
					}
					$('#mapPanel').height($('#mapPanel').width());
					searchKeyword($('#area').val());
					$('#lookMapButton').html('地图缓冲').attr('disabled', 'disabled');
					setTimeout(function(){
						$('#lookMapButton').html('查看地图').removeAttr('disabled');
					}, 3000);
				})
				$('#area').keydown(function(){
					if(event.keyCode == 13){
						$('#lookMapButton').click();
						return false;
					}
				});
			}
			//调用初始化函数地图
			
			function select_address(_address){
				if(typeof(_address) == 'string'){
					_address = [_address];
				}
				$('#mapAddress').html('');
				for(var i in _address)
				{
					__address = _address[i];
					if(typeof(__address) == 'object'){
						__address = __address.address + __address.name;
					}
					$('<div>').css('marginBottom', '6px').append('[').append(
						$('<a>').attr('href', 'javascript:').attr('address', __address).append('保存地址').click(function(){
							var temp = null;
							var address = $(this).attr('address');
							var allAddress = address;
							var province = '';
							var city = '';
							
							if(address.indexOf('市') == -1){
								alert('该地址无法选择，请直接填写！');
								return;
							}
							if(address.indexOf('省') != -1)
							{
								temp = address.split('省');
								province = temp[0];
								province = province.replace('中国', '') + '省';
								temp = temp[1];
								temp = temp.split('市');
								city = temp[0];
								address = temp[1];
							}
							else
							{
								temp = address.split('市');
								province = temp[0].replace('中国', '') + '市';
								city = temp[1];
								address = temp[2];
							}
							
							$('#province').find('option').each(function(){
								if($(this).html() == province){
									$(this).attr("selected",true);
									$('#province').change();
								}
							});
							$('#city').find("option").each(function(){
								if($(this).html() == city){
									$(this).attr("selected",true);
								}
							}); 
							$('#area').val(allAddress);
							$('#lookMapButton').click();
						})
					).append(']&nbsp;&nbsp;' + __address + '<br/>').appendTo($('#mapAddress'));
				}
				map_init.address = _address[0];
			}
			
			function init_city_select(){
				var value = $('#province').val();
				var citys = [];
				if(value != '')
				{
					citys = cities[value];
				}
				$('#city').html('');
				$('<option>').html(citys[i]).attr('value', '').appendTo('请选择城市');
				for(var i in citys){
					$('<option>').html(citys[i]).attr('value', citys[i]).appendTo('#city');
				}
			}
			
			
			
			function setCity(city){
				setCity.cs.searchCityByName(city);
			}
			
			//调用poi类信接口                                         
			function searchKeyword(keyword) {
				var searchService = searchKeyword.ss;
				//clearOverlays(markers);
                //根据输入的城市设置搜索范围
                searchService.setLocation(map_init.city);
                //设置搜索页码
                searchService.setPageIndex(1);
                //设置每页的结果数
                searchService.setPageCapacity(10);
                //根据输入的关键字在搜索范围内检索
                searchService.search(keyword);
			}
			
			function clearOverlays(overlays) {
                var overlay;
                while (overlay = overlays.pop()) {
                    overlay.setMap(null);
                }
            }
			
			function select_province(obj, type){
				$('#mapPanel').height($('#mapPanel').width());
				init_city_select();
				//select_city($('#city'));
			}
			
			function select_city(obj){
				setCity($(obj).find('option:selected').text());
			}
			</script>
			<div>
				<label class="col-xs-12 col-sm-2 control-label"></label>
				<div id="mapPanel" class="map_panel"></div>
				<div id="mapAddress" class="map_address" style=""></div>
				<div class="clear"></div>
			</div>
		
		{/if}
          <!-- 行业分类 end -->
          
          <div class="form-group">
            <label for="txt_price" class="col-xs-12 col-sm-2 control-label ">授权使用价： </label>
            <div class="col-sm-3 col-xs-6 col-sm-4 col-md-3 col-lg-3">
              <div class="input-group">
                <span class="input-group-addon">￥</span>
                <input type="text" class="form-control" id="txt_price" name="txt_price" placeholder="授权价格" value="{$arrPubInfo['txt_price']}" onkeyup="clearstr(this);">
              </div>
		    </div>
            <div class="col-sm-3 col-xs-6 col-sm-4 col-md-3 col-lg-3">
				<select name="unite_price" id="unite_price" class="form-control">
                    {loop $arrPriceUnit $v}
					<option value="{$v}" {if $arrPubInfo['unite_price']==$v}selected{/if}>/{$v} </option>
                    {/loop}
                </select>
            </div>
            
            

       </div>
        

          <div class="form-group">
            <div class="col-sm-offset-3 col-sm-6">
              <button type="submit" class="btn btn-primary" value="下一步" >下一步</button>
            </div>
          </div>
          <!-- form-group end -->

          <div class="form-group">
            <div class="col-sm-offset-3 col-sm-6">
              <div class="checkbox">
              <label>
                <input type="checkbox" checked="checked" value="true" name="agreementchecked" id="agreementchecked"> 同意 <a href="javascript:void(0);" id="viewPubAgreement">《知识产权申明》 </a>
              </label>
            </div>
            </div>
          </div>
          <!-- form-group end -->

        </form>
	<div class="release-agreement hidden">
		<div class="agreement-header">
			<h2 class="agreement-title">《知识产权申明》</h2>
		</div>
		<p>  <!--{tag 作品出售协议}--></p>
	</div>
</div>
<link rel="stylesheet" type="text/css" href="static/js/webuploader/webuploader.css">
<script type="text/javascript" src="static/js/webuploader/webuploader.js?r={RANDOM_PARA}"></script>
<script type="text/javascript" src="static/js/webuploader/kppw.webuploader.js"></script>
<script type="text/jscript">
$(function(){
	var uploadsize = parseInt("{$basic_config['max_size']}");
	uploadsize =  isNaN(uploadsize)? 1 : uploadsize;	
	$("#picker").KKUploader(
		{
			accept: {
				extensions 		: 'jpg,jpeg,gif,png,bmp'
			},
			fileNumLimit		: 1,
			separator			: '|',
			fileSingleSizeLimit	: uploadsize*1024*1024,
			fileVal				: 'upload',
			listName			: "fileList_upload",
			hiddenName 			: 'fileid1',
			//hiddenValType       : 2,
			editListName		:'edit_fileList_upload'
		},
		{
			filename 			: 'upload',
			fileType			: 'service'
		}
	);
	
	
	//官方上传插件
	$("#picker1").KKUploader(
		{
			accept: {
				extensions 		: '{$strExtTypes2}'
			},
			fileNumLimit		: 30, 
			separator			: ',',
			fileSingleSizeLimit	: uploadsize*1024*1024,
			fileVal				: 'edit_fileList_upload2',
			listName			: "fileList_file_path_2",
			editListName		: 'edit_fileList_upload2',
			hiddenName 			: 'file_path_2',
			hiddenValType 		: '2'
		},
		{
			filename 			: 'upload2',
			fileType			: 'service'
		}
	);	
	
	//官方上传插件 背景音乐
	$("#picker2").KKUploader(
		{
			accept: {
				extensions 		: 'mp3'
			},
			fileNumLimit		: 1,
			separator			: '|',
			fileSingleSizeLimit	: uploadsize*1024*1024,
			fileVal				: 'upload3',
			listName			: "fileList_file_path_3",
			editListName		: 'edit_fileList_upload3',
			hiddenName 			: 'view_music',
			hiddenValType 		: '2'
		},
		{
			filename 			: 'upload3',
			fileType			: 'service'
		}
	);	
	
});
</script>